# OMNISIGHT v0.2.1 Deployment Failure Analysis

> Camera: Axis P3285-LVR (ARTPEC-9)
> Date: October 24, 2025
> Error: "Can't install app unspecific error"

## Executive Summary

OMNISIGHT v0.2.1 deployment **FAILED** on P3285-LVR with "unspecific error" during installation. Root cause identified as **missing `package.conf` file** in the ACAP package.

## Error Analysis

### User-Reported Error

```
"Can't install app unspecific error. check logs for more information"
```

### Log Analysis

**Critical Error from Logs**:
```
2025-10-24T16:45:01.202-06:00 axis-e82725203c16 [ ERR ] acapctl[5091]:
    code 10: /usr/src/debug/acapctl/2.20.8/src/file.c:194:
    Failed setting ownership of /usr/local/packages/omnisight.tmp/package.conf:
    No such file or directory
```

**Deployment Timeline**:
```
16:45:00.883 - Upload: OMNISIGHT_-_Precognitive_Security_0_2_1_aarch64.eap (9163 bytes)
16:45:00.943 - Signature verification: SUCCESS (unsigned package accepted)
16:45:00.951 - Manifest extraction: SUCCESS
16:45:01.003 - Installation started
16:45:01.202 - ERROR: package.conf not found
16:45:01.227 - Installation FAILED
```

## Root Cause

### Missing File: `package.conf`

The ACAP installer (`acapctl`) expects **both** `manifest.json` **and** `package.conf` to be present in the package. Our build script only included `manifest.json`.

**Evidence from logs**:
- ✅ Package uploaded successfully (9 KB)
- ✅ Signature verified
- ✅ Manifest extracted successfully
- ❌ **Failed setting ownership of package.conf** - file doesn't exist

### Why This Matters

According to Axis documentation and pandosme's examples:

1. **Modern ACAP (Schema 1.8.0)**: Uses `manifest.json` as primary configuration
2. **Backward Compatibility**: `package.conf` still required for installation tooling
3. **Build Tools**: Official ACAP SDK automatically generates `package.conf` from `manifest.json`
4. **Manual Packaging**: We bypassed SDK and created tarball manually

**Our mistake**: We thought `manifest.json` alone was sufficient for modern ACAP packages.

## Package Comparison

### v0.2.1 (FAILED) - 9 KB
```
LICENSE
api/
html/
hybrid_server.py
manifest.json          ✅ Present
omnisight
[NO package.conf]      ❌ MISSING
```

### v0.2.2 (FIXED) - 9 KB
```
LICENSE
api/
html/
hybrid_server.py
manifest.json          ✅ Present
package.conf           ✅ ADDED
omnisight
```

## The Fix

### Created `package-hybrid.conf`

```bash
PACKAGENAME="OMNISIGHT - Precognitive Security"
APPTYPE="aarch64"
APPNAME="omnisight"
APPID="1001"
LICENSENAME="Available"
LICENSEPAGE="none"
VENDOR="OMNISIGHT"
REQEMBDEVVERSION="3.0"
APPMAJORVERSION="0"
APPMINORVERSION="2"
APPMICROVERSION="2"
APPGRP="sdk"
APPUSR="sdk"
APPOPTS=""
OTHERFILES=""
SETTINGSPAGEFILE="html/index.html"
SETTINGSPAGETEXT=""
VENDORHOMEPAGELINK='<a href="https://github.com/oneshot2001/OmniSight-dev" target="_blank">github.com/oneshot2001/OmniSight-dev</a>'
PREUPGRADESCRIPT=""
POSTINSTALLSCRIPT=""
STARTMODE="respawn"
HTTPCGIPATHS=""
```

### Updated Build Script

Added to `build-hybrid-eap.sh`:
```bash
# Copy manifest and package.conf
echo "Creating manifest and package.conf..."
cp "$SCRIPT_DIR/manifest-hybrid.json" "$PACKAGE_DIR/manifest.json"
cp "$SCRIPT_DIR/package-hybrid.conf" "$PACKAGE_DIR/package.conf"
```

## Camera Information

**Model**: Axis P3285-LVR
**ARTPEC**: ARTPEC-9 (confirmed from logs: `PACKAGE_ARCHS` includes "artpec-9 p3285")
**MAC**: E82725203C16
**Firmware**: AXIS OS (version not explicitly shown in logs)

**Note**: Different camera than previous logs (M4228-LVE with ARTPEC-8). This confirms our SoC-agnostic design goal.

## Deployment Attempts Log

| Time | Package | Size | Result | Error |
|------|---------|------|--------|-------|
| 16:20:20 | v0.2.0 | 13.6 KB | ❌ Failed | Unsigned package rejected |
| 16:20:55 | v0.2.0 | 13.6 KB | ❌ Failed | Missing package.conf |
| 16:45:01 | v0.2.1 | 9.2 KB | ❌ Failed | Missing package.conf |

**Pattern**: All attempts failed at "setting ownership of package.conf" stage.

## Lessons Learned

### 1. ACAP Package Structure Requirements

**Both files are required**:
- `manifest.json` - Modern configuration (schema 1.8.0)
- `package.conf` - Legacy configuration (backward compatibility)

Even with manifest.json schema 1.8.0, the installation tooling still expects package.conf.

### 2. Manual Packaging Pitfalls

When creating ACAP packages manually (without Docker/SDK):
- ✅ Can create functional packages
- ⚠️ Must understand **complete** package structure
- ⚠️ Cannot rely solely on documentation about "modern" schemas
- ⚠️ Must include **all** files that SDK would generate

### 3. Error Message Quality

The camera's error message "Can't install app unspecific error" was:
- ❌ Not helpful for diagnosis
- ✅ Logs provided the actual error
- ✅ Always check system logs for details

## v0.2.2 Changes

### Version Bump: 0.2.1 → 0.2.2

**Changes**:
1. ✅ Added `package.conf` file
2. ✅ Updated build script to include it
3. ✅ Updated manifest version to 0.2.2
4. ✅ Package size: 9 KB (same, minimal overhead)

**What stayed the same**:
- Hybrid Python server (http.server)
- Zero external dependencies
- 14 JSON API endpoints
- All Phase 2.1 features

## Testing Status

### Local Build ✅
- [x] Package created successfully
- [x] Size: 9 KB
- [x] Files verified: `manifest.json` + `package.conf` both present

### Hardware Deployment ⏳
- [ ] Deploy to P3285-LVR
- [ ] Verify no "package.conf" error
- [ ] Application starts successfully
- [ ] Web dashboard accessible
- [ ] API endpoints respond

## Deployment Instructions for v0.2.2

**Package**: `OMNISIGHT_-_Precognitive_Security_0_2_2_aarch64.eap` (9 KB)

**Expected behavior**:
1. Upload succeeds
2. Signature verification succeeds (unsigned accepted)
3. Manifest extraction succeeds
4. **package.conf ownership set successfully** ← FIX
5. Installation completes
6. Application starts (respawn mode)

**If it fails again**, check logs for:
- Different error message (not package.conf)
- Python availability
- File permissions
- Disk space

## Next Steps

1. **Deploy v0.2.2** to P3285-LVR
2. **Verify installation** completes without errors
3. **Test startup** - no "Exec format error"
4. **Validate API** - all 14 endpoints respond
5. **Cross-test M4228-LVE** - ensure both cameras work

## References

- Previous failure analysis: [DEPLOYMENT_FAILURE_ANALYSIS.md](DEPLOYMENT_FAILURE_ANALYSIS.md) (v0.2.0)
- Pandosme ACAP examples: https://github.com/pandosme/make_acap
- Axis ACAP documentation: https://developer.axis.com/acap/

---

**Status**: Fixed in v0.2.2 ✅
**Ready for deployment**: Yes
**Confidence level**: High - Root cause identified and corrected
