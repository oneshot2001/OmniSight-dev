#!/bin/sh
# OMNISIGHT Hybrid API Server Launcher v0.2.4
# Simplified: Tries Python paths directly without command -v
# Compatible with minimal shell environments (ARTPEC-8 and ARTPEC-9)

# Set environment variables
export OMNISIGHT_HTML_DIR="/usr/local/packages/omnisight/html"
export OMNISIGHT_API_DIR="/usr/local/packages/omnisight/api"
export PORT=8080

# Change to package directory
cd /usr/local/packages/omnisight || exit 1

# Try Python paths in order (first success wins)
# Using || to continue to next if current fails

echo "OMNISIGHT starting..." >&2

# Try /usr/bin/python3 first (ARTPEC-8)
if /usr/bin/python3 --version >/dev/null 2>&1; then
    echo "Using /usr/bin/python3" >&2
    exec /usr/bin/python3 hybrid_server.py
fi

# Try /usr/bin/python (ARTPEC-9)
if /usr/bin/python --version >/dev/null 2>&1; then
    echo "Using /usr/bin/python" >&2
    exec /usr/bin/python hybrid_server.py
fi

# Try python3 from PATH
if which python3 >/dev/null 2>&1; then
    echo "Using python3 from PATH" >&2
    exec python3 hybrid_server.py
fi

# Try python from PATH
if which python >/dev/null 2>&1; then
    echo "Using python from PATH" >&2
    exec python hybrid_server.py
fi

# If we get here, no Python was found
echo "ERROR: No Python interpreter found!" >&2
echo "Tried: /usr/bin/python3, /usr/bin/python, python3, python" >&2
exit 127
